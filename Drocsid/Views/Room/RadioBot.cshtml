
@{
    ViewBag.Title = "RadioBot";
    Layout = "~/Views/MasterView.cshtml";
}

<div class="content">
    <h2>Радио бот</h2>
    <div class="room_content" id="player">
        <div class="RP_player_5 horizontal"><div class="rp-header"><a href="https://radiopotok.ru/" target="_blank">Radio online</a></div></div>
        <script type="text/javascript" src="//yandex.st/jquery/1.8.2/jquery.min.js"></script>
        <script async type="text/javascript" src="//radiopotok.ru/f/script5/8ce27b9d78f2921f0912899fc2feb3ec.js" charset="UTF-8"></script>
    </div>
    <div class="chat" id="messages"></div>
    @if (User.Identity.IsAuthenticated)
    {
            <div class="chat_form">
                <input type="text" name="name" value="" id="message"/>
                <input id="go_reg" type="button" value="Отправить" />
            </div>
    }
    else
    {
        <div class="chat_form">Для отправки сообщений вы должны быть авторизованы</div>
    }


</div>
<script type="text/javascript">
    var username = "@User.Identity.Name";
    var socket,
        $txt = document.getElementById('message'),
        $messages = document.getElementById('messages');

    if (typeof (WebSocket) !== 'undefined') {
        socket = new WebSocket("ws://localhost/Drocsid/ChatHandler.ashx");
    } else {
        socket = new MozWebSocket("ws://localhost/Drocsid/ChatHandler.ashx");
    }

    socket.onmessage = function (msg) {
        var el = document.createElement('p');
        el.innerHTML = msg.data;
        $messages.appendChild(el);

    };

    socket.onclose = function (event) {
        alert('Обрыв соединения. Пожалуйста, обновите страницу');
    };

    document.getElementById('go_reg').onclick = function () {
        if ($txt.value.length > 0) {
            socket.send(username + ': ' + $txt.value);
            $txt.value = '';
        }
    };

        window.onload = function () {
            var scrollinDiv = document.getElementById('messages');
            setInterval(function () {
                scrollinDiv.scrollTop = 9999;
            }, 100);
    }

</script>